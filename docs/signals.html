<!DOCTYPE html>  <html> <head>   <title>signals.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="accessors.html">                 accessors.coffee               </a>                                           <a class="source" href="decorator.html">                 decorator.coffee               </a>                                           <a class="source" href="filters.html">                 filters.coffee               </a>                                           <a class="source" href="posture.html">                 posture.coffee               </a>                                           <a class="source" href="signals.html">                 signals.coffee               </a>                                           <a class="source" href="validators.html">                 validators.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               signals.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>TODO: package level docs!</p>             </td>             <td class="code">               <div class="highlight"><pre> <span class="nv">signals =</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Used when extending the signals config of one object with additional callbacks</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <ul>
<li>@param: {object} target A map of signal name: [ array of callbacks ]</li>
<li>@param: {object} source A map of signal name: [ array of callbacks ]</li>
<li>@example</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><code>javascript
   app.Soup = app.Food.extend({
       signals: {
           preInit: [
               'before',
               function(attrs){ if (attrs.broth &amp;&amp; attrs.broth === 'beef') alert('Tasty!') }
           ]
       }
   });
</code></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>When Posture extends Food's signals with Soup's signals, it will prepend Soup's preInit rather than appending it.</p>             </td>             <td class="code">               <div class="highlight"><pre>   <span class="nv">extend: </span><span class="nf">(target, source) -&gt;</span>

        <span class="nv">output = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Iterate the source callbacks config</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">source</span><span class="p">,</span> <span class="nf">(val, name)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>The first member of the is either a positional argument: 'before' or 'after' OR a callback.</h2>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">position = </span><span class="k">if</span> <span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">isFn</span> <span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">then</span> <span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">shift</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;after&#39;</span>
            <span class="nv">after = </span><span class="nx">position</span> <span class="o">is</span> <span class="s1">&#39;after&#39;</span>
            <span class="nv">callbacks = </span><span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">or</span> <span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>If target has this key in its config, then append or prepend source's callbacks as appropriate</h2>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="nx">target</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span>
                <span class="nx">output</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">if</span> <span class="nx">after</span> <span class="k">then</span> <span class="nx">source</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="k">else</span> <span class="nx">callbacks</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="k">if</span> <span class="nx">after</span> <span class="k">then</span> <span class="nx">callbacks</span> <span class="k">else</span> <span class="nx">source</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span>
            <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>If not, just copy source's callbacks</h2>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">output</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">source</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span>

        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">target</span><span class="p">,</span> <span class="nf">(val, name) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>console.log('val: %o', val)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="o">not</span> <span class="nx">isFn</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="nx">val</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nx">source</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span> <span class="o">and</span> <span class="nx">val</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="nx">output</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>

        <span class="nx">output</span>

    <span class="nv">connect: </span><span class="nf">(signal, callback, context=@) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h2>*</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">Subscribe</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">signal</span> <span class="nx">using</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Event</span><span class="s1">&#39;s bind</span>
<span class="s1">        @param {string} signal      The name of the signal</span>
<span class="s1">        @param {function} callback  The callback that we are binding to the signal</span>
<span class="s1">        @param {object} context     (optional) The &#39;</span><span class="k">this</span><span class="s1">&#39; for the callback</span>

<span class="s1">#DIVIDER</span>
<span class="s1">        if typeof signal == &quot;string&quot; and isFn(callback)</span>
<span class="s1">            return @bind(&quot;signals:&quot; + signal, callback, context)</span>
<span class="s1">        throw &quot;&quot;&quot;</span>
<span class="s1">        connect takes two arguments:</span>
<span class="s1">        1. signal: a string identifying the signal to listen for, and</span>
<span class="s1">        2. callback: a function to handle the signal</span>
<span class="s1">        Arguments were signal: #{signal} #{signal.toString()} and callback #{callback}</span>
<span class="s1">        &quot;&quot;&quot;</span>

<span class="s1">    signal: (signal, args...) -&gt;</span>

<span class="s1">#DIVIDER</span>
<span class="s1">        Publish a signal and it&#39;</span><span class="nx">s</span> <span class="nx">arguments</span> <span class="nx">via</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Event</span><span class="err">&#39;</span><span class="nx">s</span> <span class="nx">trigger</span>
        <span class="nx">@param</span> <span class="p">{</span><span class="nx">string</span><span class="p">}</span> <span class="nx">signal</span>  <span class="nx">The</span> <span class="nx">name</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">signal</span>
        <span class="nx">@param</span> <span class="p">{</span><span class="nx">array</span><span class="p">}</span> <span class="nx">args</span>     <span class="nx">The</span> <span class="nx">rest</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">arguments</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@trigger</span><span class="p">(</span><span class="s2">&quot;signals:#{signal}&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">...)</span>

    <span class="nv">init: </span><span class="nf">(obj)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>*</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">Iterate</span> <span class="nx">the</span> <span class="nx">signal</span> <span class="nx">callback</span> <span class="nx">config</span> <span class="p">(</span><span class="nx">@connect_to</span><span class="p">)</span> <span class="k">of</span> <span class="k">this</span> <span class="nx">instance</span> <span class="o">and</span> <span class="nx">connect</span> <span class="nx">callbacks</span> <span class="nx">to</span> <span class="nx">signals</span><span class="p">.</span>
        <span class="vi">@param: </span><span class="p">{</span><span class="nx">object</span><span class="p">}</span> <span class="nx">A</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span> <span class="o">or</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span> <span class="nx">instance</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">connect_to</span>
            <span class="nv">obj::connect = </span><span class="nx">@connect</span>
            <span class="nv">obj::signal = </span><span class="nx">@signal</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">connect_to</span><span class="p">,</span> <span class="nf">(list, signal) -&gt;</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">list</span><span class="p">,</span> <span class="nf">(callback) -&gt;</span>
                    <span class="k">if</span> <span class="nx">isFn</span> <span class="nx">callback</span>
                        <span class="nx">@connect</span> <span class="nx">signal</span><span class="p">,</span> <span class="nx">callback</span>
                <span class="p">,</span> <span class="err">@</span>
            <span class="p">,</span> <span class="err">@</span>

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>*</h2>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h1>#</h1>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 