var Posture,accessors,decorator,filters,isFn,noFuncs,root,signals,toArray,validators,_,_addPreAndPost,_camel,_posture_props,_prePost_default_methods,__slice=Array.prototype.slice,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};root=this,typeof exports!="undefined"&&exports!==null?Posture=exports:Posture=root.Posture={},_=root._,!_&&typeof require!="undefined"&&require!==null&&(_=require("underscore")._),_posture_props={Collection:{},Model:{},Router:{},View:{}},_.extend(Posture,_posture_props),isFn=_.isFunction,toArray=_.toArray,noFuncs=function(a){var b,c,d,e;e=["before","after","wrap"];for(c=0,d=e.length;c<d;c++){b=e[c];if(a[b]&&isFn(a[b]||null))return!1}return!0},decorator=function(a){var b;if(!a||!a.func||!isFn(a.func)||noFuncs(a)===!0)throw"A function to decorate and one or more of a before, after or wrapping function must be specified.";return a.wrap&&isFn(a.wrap)&&(a.func=function(a){return function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],b.unshift(a.func),a.wrap.apply(a.context||this,b)}}(a)),b=function(){var b,c,d,e,f;return c=1<=arguments.length?__slice.call(arguments,0):[],a.before&&(d=a.before.apply(this,c)),a.chain_returns&&(e=c,c=d),f=a.func.apply(this,c),a.chain_returns&&(c=e.concat([f])),b=a.after?a.after.apply(this,c):f,a.chain_returns?b:f},b[a.indicator||"_is_decorated_"]=!0,a.context?_.bind(b,a.context):b},decorator.decorateMethod=function(a,b,c){c.assignToProto&&a.prototype&&(a=a.prototype);if(!a||!b||!c||noFuncs(c))throw"decorateMethod requires an object and method name and one or more of before, after and wrap options";return _.extend(c,{func:a[b]||function(){},context:c.addContext===!0?a:null}),a[b]=decorator(c),!0},Posture.Decorator=decorator,Posture.Validator=validators,_camel=function(a,b){var c,d;return a=a.toLowerCase(),c=b[0].toUpperCase(),d=b.substr(1),""+a+c+d},_prePost_default_methods=["initialize","save","destroy","render","navigate"],_addPreAndPost=function(a,b){var c;return a.prototype[b].__has_pre_post__?null:(c={before:function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],b==="initialize"&&this._connectAll(),this.signal.apply(this,[_camel("pre",b)].concat(__slice.call(a)))},after:function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],this.signal.apply(this,[_camel("post",b)].concat(__slice.call(a)))},assignToProto:!0,indicator:"__has_pre_post__"},decorator.decorateMethod(a,b,c))},signals={extend:function(a,b){var c;return c={},_.each(b,function(d,e){var f,g,h;return g=a[e]!=null&&_.isArray(a[e])&&!isFn(a[e][0])?a[e].shift():"after",f=a[e]||[],a[e]!=null?(h=g==="replace"?[]:b[e],c[e]=(g==="after"?h:f).concat(g==="after"?f:h)):c[e]=[].concat(b[e])}),_.each(a,function(a,d){isFn(a[0]&&_.isArray(a))||a.shift();if(b[d]==null&&a.length>0)return c[d]=a}),c},connect:function(a,b,c){c==null&&(c=this);if(typeof a=="string"&&isFn(b))return this.bind("signals:"+a,b,c);throw"connect takes two arguments:\n1. signal: a string identifying the signal to listen for, and\n2. callback: a function to handle the signal\nArguments were signal: "+a+" "+a.toString()+" and callback "+b},signal:function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],a.unshift(this),this.trigger.apply(this,["signals:"+b].concat(__slice.call(a)))},connectAll:function(){if(this.signals)return _.each(this.signals,function(a,b){var c;return c={},_.each(a,function(a){if(isFn(a)&&!_.has(c[b]||[],a))return this.connect(b,a),c[b]=c[b]||[],c[b].push(a)},this)},this)},init:function(a){return a.prototype._connectAll=signals.connectAll,a.prototype.connect=signals.connect,a.prototype.signal=signals.signal,a.prototype._has_signals_=!0,_.each(_prePost_default_methods,function(b){if(a.prototype[b]&&isFn(a.prototype[b]))return _addPreAndPost(a,b)})}},Posture.Signals=signals,accessors={init:function(a){return _.each(a.prototype.defaults,function(b,c){return a.prototype[c]=function(a,b,d){var e,f;d==null&&(d=this);switch(a){case null:case void 0:f=this.get(c);break;case _:f=_(this.get(c)).chain();break;case"subscribe":isFn(b)?f=this.bind("change:"+c,b,d):(e={},e[c]=a,f=this.set(e,b));break;case isFn(a):e={},e[c]=!b||!b.func_is_val?a():a,f=this.set(e,b);break;default:e={},e[c]=a,f=this.set(e,b)}return f},a.prototype[c].accessorized=!0})}},Posture.Accessors=accessors,filters={integer:function(a,b){return a=b?filters.regex(a,/[^\d\.]+/g,""):a,parseInt(a)},decimal:function(a,b){return a=b?filters.regex(a,/[^\d\.]+/g,""):a,parseFloat(a)},alpha:function(a,b){var c;return c=b?/[^a-zA-Z\s]/g:/[^a-zA-Z]/g,filters.regex(a,c,"")},alnum:function(a,b){var c;return c=b?/[^\da-zA-Z\s]/g:/[^\da-zA-Z]/g,filters.regex(a,c,"")},to_json:function(a){return JSON.stringify(a)||null},trim:function(a){return filters.regex(a,/^\s+|\s+$/g,"")},regex:function(a,b,c,d){return c==null&&(c=""),d==null&&(d=null),b=_.isRegExp(b)?b:new RegExp(""+b,d),(""+a).replace(b,c)},bool:function(a,b){var c;return _.isObject(a||_.isArray(a))?!_.isEmpty(a):!b||(c=(""+a).toLowerCase())!=="false"&&c!=="no"&&c!=="off"&&c!=="null"&&c!=="0"?!!a:!1}},Posture.Filters=filters,validators={lessThan:function(a,b,c){if(c&&a<=b||a<b)return!0;throw new validators.NotLessThan(a,b)},greaterThan:function(a,b,c){if(c&&a>=b||a>b)return!0;throw new validators.NotGreaterThan(a,b)},notEmpty:function(a){if(!_.isEmpty(a)&&a===!void 0)return!0;throw new validators.IsEmpty(a)},decimalPlaces:function(a,b,c){var d;b==null&&(b=2),d=Posture.Filter.trim(""+a).split(".");if(d.length===1)return!0;if(d.pop().length<=b)return!0;throw new validators.Invalid(c||"'"+a+"' has too many decimal places! Only "+b+" are allowed.")},regex:function(a,b,c){var d;d=b instanceof RegExp?b:new RegExp(b);if(d.test(a))return!0;throw new validators.Invalid(c||"'"+a+"' does not fit the required pattern: "+d)}},validators.Invalid=function(){function a(a){this.message=a}return __extends(a,Error),a.prototype.toString=function(){return isFn(this.message)?this.message():this.message},a}(),validators.NotLessThan=function(){function a(a,b,c){this.val=a,this.max=b,this.message=c!=null?c:null,this.message||(this.message=""+this.val+" is greater than the allowed maximum: "+this.max)}return __extends(a,validators.Invalid),a}(),validators.NotGreaterThan=function(){function a(a,b,c){this.val=a,this.min=b,this.message=c!=null?c:null,this.message||(this.message=""+this.val+" is less than the allowed minimum: "+this.max)}return __extends(a,validators.Invalid),a}(),validators.IsEmpty=function(){function a(a,b){this.val=a,this.message=b!=null?b:null,this.message||(this.message="'"+a+"' is empty")}return __extends(a,validators.Invalid),a}(),Posture.Validators=validators,Posture.enhance={_default:function(){var a,b,c,d,e,f;return e=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[],b.length===3&&(d=b.pop()),f=b[0],a=b[1],e=d||e,f.signals&&e.prototype.signals&&(f.signals=signals.extend(f.signals,e.prototype.signals)),c=e.extend.apply(e,b),signals.init(c),c},Model:function(){var a,b,c,d;return c=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],b=(d=Posture.enhance)._default.apply(d,[c].concat(__slice.call(a))),accessors.init(b),b},Collection:function(){var a,b,c,d;return c=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],b=(d=Posture.enhance)._default.apply(d,[c].concat(__slice.call(a))),b},View:function(){var a,b,c,d;return c=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],b=(d=Posture.enhance)._default.apply(d,[c].concat(__slice.call(a))),b},Router:function(){var a,b,c,d;return c=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],b=(d=Posture.enhance)._default.apply(d,[c].concat(__slice.call(a))),b}},Posture.init=function(a){return _.each(a,function(a,b){if(a.extend&&isFn(a.extend)&&Posture.enhance[b]!=null)return Posture[b].extend=function(){var c,d;return c=1<=arguments.length?__slice.call(arguments,0):[],(d=Posture.enhance)[b].apply(d,[a].concat(__slice.call(c)))}})}