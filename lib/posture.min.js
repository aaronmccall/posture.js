var Posture,accessors,decorator,filters,isFn,noFuncs,root,signals,toArray,validators,_,_sig_defaults,__slice=Array.prototype.slice,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};root=this,typeof exports!="undefined"&&exports!==null?Posture=exports:Posture=root.Posture={},_=root._,!_&&typeof require!="undefined"&&require!==null&&(_=require("underscore")._),isFn=_.isFunction,toArray=_.toArray,noFuncs=function(a){var b,c,d,e;e=["before","after","wrap"];for(c=0,d=e.length;c<d;c++){b=e[c];if(a[b]&&isFn(a[b]||null))return!1}return!0},decorator=function(a){var b;if(!a||!a.func||!isFn(a.func)||noFuncs(a)===!0)throw"A function to decorate and one or more of a before, after or wrapping function must be specified.";return a.wrap&&isFn(a.wrap)&&(console.log("wrapping",a.wrap.toString()),a.func=function(a){return function(){var b;return b=1<=arguments.length?__slice.call(arguments,0):[],b.unshift(a.func),a.wrap.apply(a.context||this,b)}}(a)),b=function(){var b,c,d,e,f;return c=1<=arguments.length?__slice.call(arguments,0):[],a.before&&(d=a.before.apply(this,c)),a.chain_returns&&(e=c,c=d),f=a.func.apply(this,c),a.chain_returns&&(c=e.concat([f])),b=a.after?a.after.apply(this,c):f,a.chain_returns?b:f},b.is_decorated=!0,a.context?_.bind(b,a.context):b},decorator.decorateMethod=function(a,b,c){c.assignToProto&&a.prototype&&(a=a.prototype);if(!a||!b||!c||noFuncs(c))throw"decorateMethod requires an object and method name and one or more of before, after and wrap options";return _.extend(c,{func:a[b]||function(){},context:c.addContext===!0?a:null}),a[b]=decorator(c),!0},Posture.Decorator=decorator,signals={extend:function(a,b){var c;return c={},_.each(b,function(d,e){var f,g,h;return h=a[e]!=null&&_.isArray(a[e])&&!isFn(a[e][0])?a[e].shift():"after",f=h==="after",g=a[e]||[],a[e]!=null?c[e]=(f?b[e]:g).concat(f?g:b[e]):c[e]=[].concat(b[e])}),_.each(a,function(a,d){isFn(a[0]&&_.isArray(a[0]))||a.shift();if(b[d]==null&&a.length>0)return c[d]=a}),c},connect:function(a,b,c){c==null&&(c=this);if(typeof a=="string"&&isFn(b))return this.bind("signals:"+a,b,c);throw"connect takes two arguments:\n1. signal: a string identifying the signal to listen for, and\n2. callback: a function to handle the signal\nArguments were signal: "+a+" "+a.toString()+" and callback "+b},signal:function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],this.trigger.apply(this,["signals:"+b].concat(__slice.call(a)))},connectAll:function(a){if(a.signals)return _.each(a.signals,function(a,b){return _.each(a,function(a){if(isFn(a))return this.connect(b,a)},this)},this)},init:function(a){return a.prototype.connect=signals.connect,a.prototype.signal=signals.signal}},Posture.Signal=signals,accessors={init:function(a){return _.each(a.prototype.defaults,function(b,c){return a.prototype[c]=function(a,b,d){var e,f;d==null&&(d=this);switch(a){case null:case void 0:f=this.get(c);break;case _:f=_(this.get(c)).chain();break;case"subscribe":isFn(b)?f=this.bind("change:"+c,b,d):(e={},e[c]=a,f=this.set(e,b));break;case isFn(a):e={},e[c]=!b||!b.func_is_val?a():a,f=this.set(e,b);break;default:e={},e[c]=a,f=this.set(e,b)}return f},a.prototype[c].accessorized=!0})}},Posture.Accessors=accessors,filters={integer:function(a,b){return a=b?filters.regex(a,/[^\d\.]+/g,""):a,parseInt(a)||0},decimal:function(a,b){return a=b?filters.regex(a,/[^\d\.]+/g,""):a,parseFloat(a)||0},alpha:function(a,b){var c;return c=b?/[^\sa-zA-Z]/g:/[^a-zA-Z]/g,filters.regex(a,c,"")},alnum:function(a,b){var c;return c=b?/^\da-zA-Z\s/g:/^\da-zA-Z/g,filters.regex(a,c,"")},to_json:function(a){return JSON.stringify(a)||null},trim:function(a){return filters.regex(a,/^\s+|\s+$/g,"")},regex:function(a,b,c,d){return b=_.isRegExp(b)?b:new RegExp(""+b,d),(""+a).replace(b,c)},bool:function(a){var b;return _.isObject(a||_.isArray(a))?!_.isEmpty(a):(b=(""+a).toLowerCase())==="false"||b==="no"||b==="off"||b==="null"||b==="0"?!1:!!a}},Posture.Filter=filters,validators={lessThan:function(a,b,c){if(c&&a<=b||a<b)return!0;throw new validators.NotLessThan(a,b)},greaterThan:function(a,b,c){if(c&&a>=b||a>b)return!0;throw new validators.NotGreaterThan(a,b)},notEmpty:function(a){if(!_.isEmpty(a)||a!==""&&a!==null&&a!==void 0)return!0;throw new validators.IsEmpty(a)},decimalPlaces:function(a,b,c){var d;b==null&&(b=2),d=Posture.Filter.trim(""+a).split(".");if(d.length===1)return!0;if(d.pop().length<=b)return!0;throw new validators.Invalid(c||"'"+a+"' has too many decimal places! Only "+b+" are allowed.")},regex:function(a,b,c){var d;d=b instanceof RegExp?b:new RegExp(b);if(d.test(a))return!0;throw new validators.Invalid(c||"'"+a+"' does not fit the required pattern: "+d)}},validators.Invalid=function(){function a(a){this.custom_msg=a}return __extends(a,Error),a.prototype.toString=function(){return isFn(this.custom_msg)?this.custom_msg():this.custom_msg},a}(),validators.NotLessThan=function(){function a(a,b,c){this.val=a,this.max=b,this.custom_msg=c!=null?c:null,this.custom_msg||(this.custom_msg=""+this.val+" is greater than the allowed maximum: "+this.max)}return __extends(a,validators.Invalid),a}(),validators.NotGreaterThan=function(){function a(a,b,c){this.val=a,this.min=b,this.custom_msg=c!=null?c:null,this.custom_msg||(this.custom_msg=""+this.val+" is less than the allowed minimum: "+this.max)}return __extends(a,validators.Invalid),a}(),validators.IsEmpty=function(){function a(a,b){this.val=a,this.custom_msg=b!=null?b:null,this.custom_msg||(this.custom_msg="* required")}return __extends(a,validators.Invalid),a}(),Posture.Validator=validators,_sig_defaults=["pre","post"],Posture.default_signals={Model:{initialize:_sig_defaults,save:_sig_defaults,destroy:_sig_defaults},View:{initialize:_sig_defaults,render:_sig_defaults}},Posture.enhance={Model:function(a,b){var c;return c=a.prototype,Posture.Accessors.init(a)},Collection:function(a,b){},View:function(a,b){},Router:function(a,b){}},Posture.init=_.bind(function(a){var b;return b={extend:{wrap:function(a,b,c){var d,e,f,g;return console.log("extend wrapper firing"),this.signals&&b.signals&&(f=b.signals,b.signals=Posture.Signal.extend(f,this.signals)),d=b.initialize||function(){},e={func:d,before:function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[],console.log("running initialize before decorator"),signals.init(this);if(this.signal)return a.unshift("preInit"),this.signal.apply(this,a)},after:function(){var a;a=1<=arguments.length?__slice.call(arguments,0):[];if(this.signal)return a.unshift("postInit"),this.signal.apply(this,a)}},b.initialize=decorator(e),b.connect=signals.connect,b.signal=signals.signal,g=a(b,c),Posture.Accessors.init(g)}}},_.each(a,function(a,b){if(a.extend&&isFn(a.extend)&&Posture.enhance[b]!=null)return this[b].extend=function(){var b,c;return b=1<=arguments.length?__slice.call(arguments,0):[],c=a.extend.apply(a,b),Posture.enhance.Model(c)}},Posture)})